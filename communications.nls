to communication-protocol
  
  process-inbox
  
  ; This is method for sending a total status to all buses
  ifelse remainder ticks 2 = 0 [ report-status ][ show inbox ]
  
  ; This is a test situation for when a bus is spawned
  if ticks = 10 and bus_id = 24 [
    spawn-bus 2
  ]
  
  ; This is a dedicated placeholder for buses that have no instructions yet
  if informed = false [
    request-info
  ]
  
end

to report-status

  let id 0
  foreach (list other buses) [
    ask ? [set id bus_id]
    
    ; Enter the things you want to report on here:
    let message ["status"]
    let content []
    set content lput free-space content
    set content lput previous_stop content
    set content lput next-stops content
    set message lput content message
    
    send-message id message
    
  ]

end

to spawn-bus [b_type]
  
  ; call this function if a bus thinks it needs to spawn a bus.
  ; Immediately pass the bus' dijkstra graph knowledge to the newly created bus.
  set spawner b_type
  add-bus b_type

end

to process-inbox

  foreach inbox [
    let message ?
    
    if item 0 item 2 message = "requesting_info" [
      ; Create a list of instructions to requested backup. 
      
      let reply ["sending_info"]
      let content []
      
      ; set content lput your_content content

      set reply lput content reply
      
      send-message item 1 message reply
      set spawner 0 ; Spawning done and passing information complete.
      
    ]
    
    if item 0 item 2 message = "sending_info" [
      
      ; taking values from message and store them in own instance variables
      
      set informed true
    ]
    
    
    if item 0 item 2 message = "requesting_vote" [
      ; TODO: implement function to process self-interest, and return preference
      send-message item 1 message "sending_vote"
    ]
    
    
    if item 0 item 2 message = "sending_vote" [
      ; TODO; implement function to store all votes and take action. Clear votes once action has been taken.
    ]

  ]
  
  ;clear-inbox

end



to request-info
  
  ; This method is called by a newborn only and sends a message to its parent requesting for information.
  
  let id 0
  foreach (list other buses) [
    ask ? [
      if spawner > 0 [set id bus_id]
    ]
  ]
  
  send-message id "requesting_info"
  
end



to clear-inbox
  set inbox []
end